<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Stock Prediction System - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
    <button class="mobile-menu-toggle" id="mobile-menu-toggle">☰</button>
    <div class="dashboard-container">
        <!-- Navigation Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>AI Stock Predictor</h2>
                <div class="status-indicator">
                    <span id="system-status" class="status-dot online"></span>
                    <span class="status-text">Online</span>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li><a href="#dashboard" class="nav-link active" data-page="dashboard">
                    <span class="nav-icon">📊</span> Dashboard
                </a></li>
                <li><a href="#models" class="nav-link" data-page="models">
                    <span class="nav-icon">🤖</span> Model Performance
                </a></li>
                <li><a href="#predictions" class="nav-link" data-page="predictions">
                    <span class="nav-icon">📈</span> Real-time Predictions
                </a></li>
                <li><a href="#news" class="nav-link" data-page="news">
                    <span class="nav-icon">📰</span> News Analysis
                </a></li>
                <li><a href="#feature-importance" class="nav-link" data-page="feature-importance">
                    <span class="nav-icon">📊</span> Feature Importance
                </a></li>
                <li><a href="#shap-analysis" class="nav-link" data-page="shap-analysis">
                    <span class="nav-icon">🔍</span> SHAP Analysis
                </a></li>
                <li><a href="#model-explainability" class="nav-link" data-page="model-explainability">
                    <span class="nav-icon">🤖</span> Model Explainability
                </a></li>
                <li><a href="#prediction-explanation" class="nav-link" data-page="prediction-explanation">
                    <span class="nav-icon">💡</span> Prediction Explanation
                </a></li>
                <li><a href="#architecture" class="nav-link" data-page="architecture">
                    <span class="nav-icon">🏗️</span> System Architecture
                </a></li>
                <li><a href="#debug" class="nav-link" data-page="debug">
                    <span class="nav-icon">🔍</span> Debug Dashboard
                </a></li>
            </ul>
            
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Header -->
            <header class="content-header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-actions">
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>Real-time Updates</span>
                    </div>
                    <div class="translate-container">
                        <button class="btn btn-translate" id="translate-btn">
                            <span>🌐</span> EN
                        </button>
                        <div class="language-dropdown" id="language-dropdown">
                            <div class="language-option" data-lang="en">🇺🇸 English</div>
                            <div class="language-option" data-lang="ko">🇰🇷 한국어</div>
                            <div class="language-option" data-lang="ja">🇯🇵 日본語</div>
                            <div class="language-option" data-lang="zh">🇨🇳 中文</div>
                            <div class="language-option" data-lang="es">🇪🇸 Español</div>
                            <div class="language-option" data-lang="fr">🇫🇷 Français</div>
                            <div class="language-option" data-lang="de">🇩🇪 Deutsch</div>
                        </div>
                    </div>
                    <button class="btn btn-gradient" onclick="dashboard.refreshAllData(); if(window.recoverAllCharts) window.recoverAllCharts();">
                        <span>🔄</span> Refresh
                    </button>
                    <button class="btn btn-export" onclick="dashboard.exportData()">
                        <span>💾</span> Export
                    </button>
                    <button class="btn btn-fullscreen" onclick="dashboard.toggleFullscreen()">
                        <span>🔍</span> Fullscreen
                    </button>
                </div>
            </header>

            <!-- Page Content Container -->
            <div class="page-content">
                <!-- Dashboard Page -->
                <div id="page-dashboard" class="page active">
                            <!-- Real-time System Status -->
                            <section class="widget large-widget">
                <h2>Real-time System Status</h2>
                <div class="system-metrics">
                    <div class="metric-card">
                        <h3>Model Performance</h3>
                        <div id="model-accuracy" class="metric-value">--</div>
                        <div class="metric-label">Accuracy</div>
                    </div>
                    <div class="metric-card">
                        <h3>Processing Speed</h3>
                        <div id="processing-speed" class="metric-value">--</div>
                        <div class="metric-label">Predictions/sec</div>
                    </div>
                    <div class="metric-card">
                        <h3>Active Models</h3>
                        <div id="active-models" class="metric-value">--</div>
                        <div class="metric-label">Count</div>
                    </div>
                    <div class="metric-card">
                        <h3>Data Sources</h3>
                        <div id="data-sources" class="metric-value">--</div>
                        <div class="metric-label">Connected</div>
                    </div>
                </div>
            </section>

            <!-- Model Performance Chart -->
            <section class="widget medium-widget">
                <h2>Model Performance Trend</h2>
                <div class="model-performance-info">
                    <strong>Reference Stock:</strong> Current model performance is measured against the <span id="performance-stock-info">S&P 500 overall average</span>.
                </div>
                <canvas id="performance-chart"></canvas>
            </section>


            <!-- Trading Volume Chart -->
            <section class="widget large-widget">
                <h2>Trading Volume Analysis</h2>
                <div class="volume-analysis-container">
                    <div class="volume-summary" id="volume-summary">
                        <div class="volume-metric">
                            <span class="label">Total Volume</span>
                            <span id="total-volume">310.6M</span>
                        </div>
                        <div class="volume-metric">
                            <span class="label">Average Volume</span>
                            <span id="avg-volume">44.4M</span>
                        </div>
                        <div class="volume-metric">
                            <span class="label">Max Volume</span>
                            <span id="max-volume">NVDA (89.1M)</span>
                        </div>
                        <div class="volume-metric">
                            <span class="label">Unusual Volume Detected</span>
                            <span class="metric-value alert" id="volume-alerts">2 cases</span>
                        </div>
                    </div>
                    <canvas id="volume-chart"></canvas>
                </div>
            </section>


            <!-- Model Comparison -->
            <section class="widget medium-widget">
                <h2>Model Comparison</h2>
                <canvas id="model-comparison-chart"></canvas>
            </section>

                </div>

                <!-- Models Performance Page -->
                <div id="page-models" class="page">
                    <div class="models-container">
                        <div class="models-grid">
                            <div class="widget large-widget">
                                <h2>Model Performance Comparison</h2>
                                <div class="model-comparison-table">
                                    <table class="performance-table">
                                        <thead>
                                            <tr>
                                                <th>Model</th>
                                                <th>Accuracy</th>
                                                <th>Precision</th>
                                                <th>Recall</th>
                                                <th>F1-Score</th>
                                                <th>Processing Time</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="model-performance-table">
                                            <!-- Dynamically generated -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="widget medium-widget">
                                <h2>Model Architecture</h2>
                                <div class="model-architecture" id="model-architecture">
                                    <!-- Dynamically generated -->
                                </div>
                            </div>
                            
                            <div class="widget medium-widget">
                                <h2>Hyperparameters</h2>
                                <div class="hyperparameters" id="hyperparameters">
                                    <!-- Dynamically generated -->
                                </div>
                            </div>
                            
                            <div class="widget medium-widget">
                                <h2>Training Performance</h2>
                                <canvas id="training-loss-chart"></canvas>
                            </div>
                            
                            <div class="widget medium-widget">
                                <h2>Cross Validation Results</h2>
                                <canvas id="cross-validation-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Predictions Page -->
                <div id="page-predictions" class="page">
                    <div class="predictions-container">
                        <div class="predictions-header">
                            <h2>Real-time Stock Predictions</h2>
                        </div>
                        
                        <div class="predictions-grid">
                            <div class="widget large-widget">
                                <h3>Prediction Chart</h3>
                                <div class="stock-selector-container">
                                    <div class="stock-selector-label">Select Stock for Chart:</div>
                                    <select class="stock-selector" id="prediction-stock-selector">
                                        <option value="A">Agilent Technologies Inc. (A)</option>
                                        <option value="ABBV">AbbVie Inc. (ABBV)</option>
                                        <option value="ABT">Abbott Laboratories (ABT)</option>
                                        <option value="ACN">Accenture plc (ACN)</option>
                                        <option value="ADBE">Adobe Inc. (ADBE)</option>
                                        <option value="AES">The AES Corporation (AES)</option>
                                        <option value="AFL">Aflac Incorporated (AFL)</option>
                                        <option value="AMD">Advanced Micro Devices Inc. (AMD)</option>
                                        <option value="AOS">A. O. Smith Corporation (AOS)</option>
                                        <option value="MMM">3M Company (MMM)</option>
                                        <option value="UNH">UnitedHealth Group Inc. (UNH)</option>
                                    </select>
                                    <div class="chart-description" id="prediction-chart-description">
                                        Currently displaying real-time price prediction chart for Agilent Technologies Inc. (A). 
                                        The blue solid line represents the actual price, and the red dashed line represents the AI model's predicted price.
                                    </div>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="prediction-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="widget medium-widget">
                                <h3>Prediction Confidence</h3>
                                <div class="confidence-meters" id="confidence-meters">
                                    <!-- 동적으로 생성됨 -->
                                </div>
                            </div>
                            
                            <div class="widget large-widget">
                                <h3>S&P 500 Prediction Results</h3>
                                <div class="table-controls">
                                    <div class="pagination-info">
                                        <span id="pagination-info">1-20 of 500 Stocks</span>
                                    </div>
                                    <div class="table-search">
                                        <input type="text" id="symbol-search" placeholder="Search Stock (e.g., AAPL)">
                                        <select id="sector-filter">
                                            <option value="all">All Sectors</option>
                                            <option value="Technology">Technology</option>
                                            <option value="Healthcare">Healthcare</option>
                                            <option value="Financials">Financials</option>
                                            <option value="Consumer">Consumer</option>
                                            <option value="Industrials">Industrials</option>
                                            <option value="Energy">Energy</option>
                                            <option value="Utilities">Utilities</option>
                                            <option value="Materials">Materials</option>
                                            <option value="Real Estate">Real Estate</option>
                                            <option value="Communication">Communication</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="predictions-table-container">
                                    <table class="predictions-table">
                                        <thead>
                                            <tr>
                                                <th>No.</th>
                                                <th>Symbol</th>
                                                <th>Company Name</th>
                                                <th>Sector</th>
                                                <th>Current Price</th>
                                                <th>Predicted Price</th>
                                                <th>Change %</th>
                                                <th>Confidence</th>
                                                <th>Prediction Time</th>
                                            </tr>
                                        </thead>
                                        <tbody id="predictions-table-body">
                                            <!-- Dynamically generated -->
                                        </tbody>
                                    </table>
                                </div>
                                <div class="pagination-container">
                                    <div class="pagination-controls">
                                    <button id="prev-page" class="pagination-btn">◀ Previous</button>
                                    <div class="page-numbers" id="page-numbers">
                                        <!-- Dynamically generated -->
                                    </div>
                                    <button id="next-page" class="pagination-btn">Next ▶</button>
                                </div>
                                <div class="pagination-summary">
                                    <select id="items-per-page">
                                        <option value="10">10 items</option>
                                        <option value="20" selected>20 items</option>
                                        <option value="50">50 items</option>
                                        <option value="100">100 items</option>
                                    </select>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- News Analysis Page -->
                <div id="page-news" class="page">
                    <div class="news-container">
                        <div class="news-header">
                            <h2>Real-time News Analysis</h2>
                            <div class="news-controls">
                                <select id="news-category">
                                    <option value="all">All Categories</option>
                                    <option value="market">Market</option>
                                    <option value="stock">Individual Stock</option>
                                    <option value="economy">Economy</option>
                                </select>
                                <select id="sentiment-filter">
                                    <option value="all">All Sentiments</option>
                                    <option value="positive">Positive</option>
                                    <option value="negative">Negative</option>
                                    <option value="neutral">Neutral</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="news-grid">
                            <div class="widget large-widget">
                                <h3>Sentiment Analysis Chart</h3>
                                <canvas id="sentiment-chart"></canvas>
                                <canvas id="sentiment-timeline-chart" style="margin-top: 20px;"></canvas>
                            </div>
                            
                            <div class="widget medium-widget">
                                <h3>News Summary</h3>
                                <div class="news-summary" id="news-summary">
                                    <div class="summary-item">
                                        <h4>Key Trends</h4>
                                        <p>The market is generally showing a positive sentiment today.</p>
                                    </div>
                                    <div class="summary-item">
                                        <h4>High Impact News</h4>
                                        <p>Fed interest rate hike comments are significantly impacting the market.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="widget medium-widget">
                                <h3>LLM Analysis Summary</h3>
                                <div class="llm-analysis-summary" id="llm-analysis-summary">
                                    <div class="summary-item">
                                        <h4>Market Sentiment (LLM)</h4>
                                        <p id="llm-market-sentiment">Loading...</p>
                                    </div>
                                    <div class="summary-item">
                                        <h4>Key Event Category (LLM)</h4>
                                        <p id="llm-event-category">Loading...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="widget medium-widget">
                                <h3>Advanced NLP Analysis</h3>
                                <canvas id="topic-modeling-visualization"></canvas>
                                <canvas id="attention-weights-chart" style="margin-top: 15px;"></canvas>
                                <canvas id="embedding-tsne-chart" style="margin-top: 15px;"></canvas>
                            </div>
                            
                            <div class="widget large-widget">
                                <h3>Real-time News Feed</h3>
                                <div class="news-feed-controls">
                                    <button id="load-more-news" class="btn btn-gradient">Load More News</button>
                                    <span id="news-loading-indicator" class="loading-indicator" style="display: none;">
                                        <div class="live-dot"></div>
                                        Loading news...
                                    </span>
                                </div>
                                <div class="news-feed" id="news-feed">
                                    <!-- Dynamically generated -->
                                </div>
                                <div id="news-scroll-end" class="scroll-end-message" style="display: none;">
                                    All news loaded.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Feature Importance Page -->
                <div id="page-feature-importance" class="page">
                    <div class="xai-container">
                        <div class="xai-header">
                            <h2>Feature Importance Analysis <span style="color: #ff6b6b; font-size: 0.8em;">(Mock Data)</span></h2>
                            <div class="xai-controls">
                                <select id="feature-model-selector">
                                    <option value="random_forest">Random Forest</option>
                                    <option value="gradient_boosting">Gradient Boosting</option>
                                    <option value="neural_network">Neural Network</option>
                                </select>
                                <button class="btn" id="refresh-feature-btn">Refresh Analysis</button>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h3>Feature Importance Overview</h3>
                            <p class="xai-description">
                                Feature importance analysis identifies which features have the greatest impact on model predictions. This helps understand what data points the AI considers most valuable for making stock predictions.
                            </p>
                        </div>

                        <div class="widget">
                            <h3>Global Feature Analysis</h3>
                            <div class="xai-grid">
                                <div id="feature-importance-chart" class="xai-chart-container">
                                    <h4>Feature Importance Ranking</h4>
                                    <p>Shows the features that the model considers most important when generating predictions.</p>
                                    <canvas id="feature-importance-canvas" style="margin-top: 10px;"></canvas>
                                </div>
                                <div id="partial-dependence-plot" class="xai-chart-container">
                                    <h4>Partial Dependence Plot</h4>
                                    <p>Shows how the model's predictions change when the value of a specific feature changes.</p>
                                    <canvas id="partial-dependence-chart"></canvas>
                                </div>
                                <div id="feature-correlation-heatmap" class="xai-chart-container">
                                    <h4>Feature Correlation Heatmap</h4>
                                    <div id="correlation-heatmap-chart"></div>
                                </div>
                                <div class="xai-chart-container">
                                    <h4>Feature Distribution Chart</h4>
                                    <canvas id="feature-distribution-chart"></canvas>
                                </div>
                                <div class="xai-chart-container">
                                    <h4>Feature Detail Chart</h4>
                                    <canvas id="feature-detail-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SHAP Analysis Page -->
                <div id="page-shap-analysis" class="page">
                    <div class="xai-container">
                        <div class="xai-header">
                            <h2>SHAP (SHapley Additive exPlanations) Analysis</h2>
                            <div class="xai-controls">
                                <select id="shap-model-selector">
                                    <option value="random_forest">Random Forest</option>
                                    <option value="gradient_boosting">Gradient Boosting</option>
                                    <option value="neural_network">Neural Network</option>
                                </select>
                                <button class="btn" id="refresh-shap-btn">Refresh Analysis</button>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h3>SHAP Overview</h3>
                            <p class="xai-description">
                                SHAP values provide a unified framework for understanding model predictions by showing the contribution of each feature to individual predictions and overall model behavior.
                            </p>
                        </div>

                        <div class="widget">
                            <h3>SHAP Analysis Results</h3>
                            <div class="xai-grid">
                                <div id="shap-summary-plot" class="xai-chart-container">
                                    <h4>SHAP Summary Plot <span style="color: #ff6b6b; font-size: 0.7em;">(Mock Data)</span></h4>
                                    <p>Shows the magnitude and direction of each feature's impact on the model output across the entire dataset.</p>
                                    <canvas id="shap-summary-chart" style="margin-top: 10px;"></canvas>
                                </div>
                                <div id="shap-force-plot" class="xai-chart-container">
                                    <h4>SHAP Force Plot</h4>
                                    <p>Visually shows how much each feature contributed to increasing or decreasing the prediction for a selected individual prediction.</p>
                                    <div id="shap-force-chart"></div>
                                </div>
                                <div id="shap-dependence-plot" class="xai-chart-container">
                                    <h4>SHAP Dependence Plot</h4>
                                    <p>Shows the relationship between a feature's value and its impact on the model's output.</p>
                                    <canvas id="shap-dependence-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h3>Individual Prediction Analysis</h3>
                            <div class="xai-controls">
                                <p class="xai-description">
                                    Analyze SHAP values for specific stock predictions to understand individual prediction reasoning.
                                </p>
                                <select id="shap-stock-selector">
                                    <option value="A">Agilent Technologies (A)</option>
                                    <option value="ABBV">AbbVie Inc. (ABBV)</option>
                                    <option value="ABT">Abbott Laboratories (ABT)</option>
                                    <option value="ACN">Accenture plc (ACN)</option>
                                    <option value="ADBE">Adobe Inc. (ADBE)</option>
                                    <option value="AES">AES Corporation (AES)</option>
                                    <option value="AFL">Aflac Inc. (AFL)</option>
                                    <option value="AMD">Advanced Micro Devices (AMD)</option>
                                    <option value="AOS">A. O. Smith Corp. (AOS)</option>
                                    <option value="MMM">3M Company (MMM)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Explainability Page -->
                <div id="page-model-explainability" class="page">
                    <div class="xai-container">
                        <div class="xai-header">
                            <h2>Advanced Model Explainability</h2>
                            <div class="xai-controls">
                                <select id="explainability-model-selector">
                                    <option value="random_forest">Random Forest</option>
                                    <option value="gradient_boosting">Gradient Boosting</option>
                                    <option value="neural_network">Neural Network</option>
                                </select>
                                <button class="btn" id="refresh-explainability-btn">Refresh Analysis</button>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h3>Model Interpretability Overview</h3>
                            <p class="xai-description">
                                Advanced techniques for understanding complex model behavior including gradient-based attribution, layer-wise analysis, and decision boundaries.
                            </p>
                        </div>

                        <div class="widget">
                            <h3>Advanced Interpretability Methods</h3>
                            <div class="xai-grid">
                                <div id="decision-tree-viz" class="xai-chart-container">
                                    <h4>Decision Tree Visualization</h4>
                                    <div id="decision-tree-container"></div>
                                </div>
                                <div id="gradient-analysis" class="xai-chart-container">
                                    <h4>Gradient-based Attribution</h4>
                                    <canvas id="gradient-attribution-chart"></canvas>
                                </div>
                                <div id="layer-wise-relevance" class="xai-chart-container">
                                    <h4>Layer-wise Relevance Propagation</h4>
                                    <canvas id="lrp-chart"></canvas>
                                </div>
                                <div id="integrated-gradients" class="xai-chart-container">
                                    <h4>Integrated Gradients</h4>
                                    <canvas id="integrated-gradients-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h3>Model Performance Analysis</h3>
                            <div class="xai-grid">
                                <div id="model-performance-metrics" class="xai-chart-container">
                                    <h4>Performance Metrics Dashboard</h4>
                                    <canvas id="performance-metrics-chart"></canvas>
                                </div>
                                <div id="learning-curves" class="xai-chart-container">
                                    <h4>Learning Curves</h4>
                                    <canvas id="learning-curves-chart"></canvas>
                                </div>
                                <div id="validation-curves" class="xai-chart-container">
                                    <h4>Validation Curves</h4>
                                    <canvas id="validation-curves-chart"></canvas>
                                </div>
                                <div id="confusion-matrix" class="xai-chart-container">
                                    <h4>Confusion Matrix and Error Analysis</h4>
                                    <p>Shows how well the model's predictions match actual values and analyzes what types of errors it makes.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prediction Explanation Page -->
                <div id="page-prediction-explanation" class="page">
                    <div class="xai-container">
                        <div class="xai-header">
                            <h2>Individual Prediction Explanations</h2>
                            <div class="xai-controls">
                                <select id="prediction-model-selector">
                                    <option value="random_forest">Random Forest</option>
                                    <option value="gradient_boosting">Gradient Boosting</option>
                                    <option value="neural_network">Neural Network</option>
                                </select>
                                <button class="btn" id="refresh-prediction-btn">Refresh Analysis</button>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h3>Prediction Explanation Overview</h3>
                            <p class="xai-description">
                                Detailed analysis of individual predictions including LIME explanations, counterfactual analysis, and what-if scenarios to understand specific prediction reasoning.
                            </p>
                        </div>

                        <div class="widget">
                            <h3>Current Prediction Analysis</h3>
                            <div class="xai-controls">
                                <p class="xai-description">
                                    Analyzes in detail why a specific prediction was made. Shows confidence levels and feature contributions for the current prediction.
                                </p>
                                <select id="explanation-stock-selector">
                                    <option value="A">Agilent Technologies (A)</option>
                                    <option value="ABBV">AbbVie Inc. (ABBV)</option>
                                    <option value="ABT">Abbott Laboratories (ABT)</option>
                                    <option value="ACN">Accenture plc (ACN)</option>
                                    <option value="ADBE">Adobe Inc. (ADBE)</option>
                                    <option value="AES">AES Corporation (AES)</option>
                                    <option value="AFL">Aflac Inc. (AFL)</option>
                                    <option value="AMD">Advanced Micro Devices (AMD)</option>
                                    <option value="AOS">A. O. Smith Corp. (AOS)</option>
                                    <option value="MMM">3M Company (MMM)</option>
                                </select>
                            </div>
                            <div class="xai-grid">
                                <div id="individual-prediction" class="xai-chart-container">
                                    <h4>Current Prediction Analysis</h4>
                                    <canvas id="individual-prediction-chart"></canvas>
                                </div>
                                <div id="feature-contribution" class="xai-chart-container">
                                    <h4>Feature Contribution Breakdown</h4>
                                    <canvas id="feature-contribution-chart"></canvas>
                                </div>
                                <div id="similar-predictions" class="xai-chart-container">
                                    <h4>Similar Historical Predictions</h4>
                                    <canvas id="similar-predictions-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h3>Prediction Performance Analysis</h3>
                            <div class="xai-grid">
                                <div id="prediction-confidence" class="xai-chart-container">
                                    <h4>Confidence Over Time</h4>
                                    <canvas id="prediction-confidence-chart"></canvas>
                                </div>
                                <div id="prediction-timeline" class="xai-chart-container">
                                    <h4>24-Hour Prediction Timeline</h4>
                                    <canvas id="prediction-timeline-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h3>Model Behavior Summary and Recommendations</h3>
                            <div id="xai-summary-recommendation">
                                <p><strong>Current Model Behavior Summary:</strong></p>
                                <ul>
                                    <li>The current model tends to use <strong>'recent 5-day trading volume change'</strong> and <strong>'news article sentiment score'</strong> as the most important predictors.</li>
                                    <li>Specifically, when predicting technology stocks, it gives high weight to the <strong>'correlation with the Nasdaq index'</strong> feature.</li>
                                    <li>The model shows more reliance on long-term moving averages than short-term volatility.</li>
                                </ul>
                                <p><strong>Recommendations:</strong></p>
                                <ul>
                                    <li>If prediction confidence is below 80%, it is recommended to take a conservative approach as the prediction is likely influenced by volatile market conditions.</li>
                                    <li>You can refer to 'Counterfactual Analysis' to see what factors can change predictions and use this for your investment strategy.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- System Architecture Page -->
                <div id="page-architecture" class="page">
                    <div class="architecture-container">
                        <div class="architecture-header">
                            <h2>🏗️ System Architecture Overview</h2>
                            <div class="architecture-controls">
                                <select id="arch-view-mode" onchange="architecture.changeView()">
                                    <option value="overview">System Overview</option>
                                    <option value="data-flow">Data Flow</option>
                                    <option value="component">Component Details</option>
                                    <option value="real-time">Real-time Status</option>
                                </select>
                                <button class="btn btn-primary" onclick="architecture.refreshArchitecture()">
                                    <span>🔄</span> Refresh
                                </button>
                                <button class="btn btn-export" onclick="architecture.exportDiagram()">
                                    <span>💾</span> Export Diagram
                                </button>
                            </div>
                        </div>

                        <div id="architecture-diagram" class="architecture-diagram-container">
                            <!-- Architecture content will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Debug Dashboard Page -->
                <div id="page-debug" class="page">
                    <div class="debug-container">
                        <div class="debug-header">
                            <h2>🔍 System Debug Dashboard</h2>
                            <div class="debug-actions">
                                <button class="btn btn-primary" onclick="debugDashboard.refreshAll()">
                                    <span>🔄</span> Refresh All
                                </button>
                                <button class="btn btn-export" onclick="debugDashboard.exportReport()">
                                    <span>📊</span> Export Report
                                </button>
                            </div>
                        </div>

                        <div class="debug-grid">
                            <!-- System Overview -->
                            <div class="widget large-widget">
                                <h3>📊 System Overview</h3>
                                <div class="system-status-grid">
                                    <div class="status-card">
                                        <div class="status-indicator" id="overall-status"></div>
                                        <div class="status-info">
                                            <h4>Overall System</h4>
                                            <span id="overall-status-text">Checking...</span>
                                        </div>
                                    </div>
                                    <div class="status-card">
                                        <div class="status-indicator" id="server-status"></div>
                                        <div class="status-info">
                                            <h4>Server Connection</h4>
                                            <span id="server-status-text">Checking...</span>
                                        </div>
                                    </div>
                                    <div class="status-card">
                                        <div class="status-indicator" id="network-status"></div>
                                        <div class="status-info">
                                            <h4>Network Status</h4>
                                            <span id="network-status-text">Checking...</span>
                                        </div>
                                    </div>
                                    <div class="status-card">
                                        <div class="status-indicator" id="api-status"></div>
                                        <div class="status-info">
                                            <h4>API Services</h4>
                                            <span id="api-status-text">Checking...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Chart Rendering Status -->
                            <div class="widget large-widget">
                                <h3>📈 Chart Rendering Status</h3>
                                <div class="pipeline-container">
                                    <div class="pipeline-section">
                                        <h4>Dashboard Charts</h4>
                                        <div class="chart-status-list" id="dashboard-charts-status">
                                            <!-- Dynamically populated -->
                                        </div>
                                    </div>
                                    <div class="pipeline-section">
                                        <h4>Prediction Charts</h4>
                                        <div class="chart-status-list" id="prediction-charts-status">
                                            <!-- Dynamically populated -->
                                        </div>
                                    </div>
                                    <div class="pipeline-section">
                                        <h4>XAI Charts</h4>
                                        <div class="chart-status-list" id="xai-charts-status">
                                            <!-- Dynamically populated -->
                                        </div>
                                    </div>
                                    <div class="pipeline-section">
                                        <h4>Training Charts</h4>
                                        <div class="chart-status-list" id="training-charts-status">
                                            <!-- Dynamically populated -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- API & Data Pipeline Status -->
                            <div class="widget medium-widget">
                                <h3>🔗 API & Data Pipeline</h3>
                                <div class="api-pipeline-status" id="api-pipeline-status">
                                    <!-- Dynamically populated -->
                                </div>
                            </div>

                            <!-- Feature Status -->
                            <div class="widget medium-widget">
                                <h3>⚙️ Feature Status</h3>
                                <div class="feature-status-list" id="feature-status-list">
                                    <!-- Dynamically populated -->
                                </div>
                            </div>

                            <!-- Performance Metrics -->
                            <div class="widget medium-widget">
                                <h3>⚡ Performance Metrics</h3>
                                <div class="performance-metrics" id="performance-metrics">
                                    <div class="metric-item">
                                        <span class="metric-label">Chart Load Time:</span>
                                        <span class="metric-value" id="chart-load-time">-</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">API Response Time:</span>
                                        <span class="metric-value" id="api-response-time">-</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">Memory Usage:</span>
                                        <span class="metric-value" id="memory-usage">-</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">JS Heap Size:</span>
                                        <span class="metric-value" id="js-heap-size">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Error Log -->
                            <div class="widget medium-widget">
                                <h3>🚨 Recent Errors</h3>
                                <div class="error-log" id="error-log">
                                    <div class="log-controls">
                                        <button class="btn-small" onclick="debugDashboard.clearErrors()">Clear</button>
                                        <button class="btn-small" onclick="debugDashboard.refreshErrors()">Refresh</button>
                                    </div>
                                    <div class="error-list" id="error-list">
                                        <!-- Dynamically populated -->
                                    </div>
                                </div>
                            </div>

                            <!-- Debug Console -->
                            <div class="widget large-widget">
                                <h3>🖥️ Debug Console</h3>
                                <div class="debug-console">
                                    <div class="console-output" id="console-output">
                                        <div class="console-line">
                                            <span class="console-timestamp">[2024-08-12 14:33:00]</span>
                                            <span class="console-level info">[INFO]</span>
                                            <span class="console-message">Debug Dashboard initialized</span>
                                        </div>
                                    </div>
                                    <div class="console-controls">
                                        <input type="text" id="console-input" placeholder="Enter debug command..." class="console-input">
                                        <button class="btn-small" onclick="debugDashboard.executeCommand()">Execute</button>
                                        <button class="btn-small" onclick="debugDashboard.clearConsole()">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Constants and Utilities -->
    <script type="module" src="constants/ElementIDs.js"></script>
    
    <!-- XAI Modules -->
    <script type="module" src="modules/XAI/FeatureImportanceRenderer.js"></script>
    <script type="module" src="modules/XAI/ShapAnalysisRenderer.js"></script>
    <script type="module" src="modules/XAI/XAIManager.js"></script>
    
    <!-- Core Modules (Load First) -->
    <script src="modules/ModuleManager.js"></script>
    <script src="modules/EventBus.js"></script>
    <script src="modules/DataService.js"></script>
    <script src="modules/APIManager.js"></script>
    <script src="modules/ChartManager.js"></script>
    <script src="modules/PageController.js"></script>
    <script src="modules/ApplicationController.js"></script>
    
    <!-- Legacy Scripts (Keep for compatibility) -->
    <script src="chart-utils.js"></script>
    <script src="common-functions.js"></script>
    <script src="translator.js"></script>
    <script src="router.js"></script>
    <script src="sp500-api-manager.js"></script>
    <script src="api-config-panel.js"></script>
    <script src="news-analyzer.js"></script>
    <script src="dashboard-extended.js"></script>
    <script src="dashboard.js"></script>
    <script src="architecture.js"></script>
    <script src="debug-dashboard.js"></script>
    
    <!-- Module System Integration -->
    <script>
      // Initialize module system when DOM is ready
      document.addEventListener('DOMContentLoaded', async () => {
        console.log('🎯 Starting modular dashboard system...');
        
        // Check if modules are properly loaded
        if (!window.ModuleManager) {
          console.error('❌ ModuleManager failed to load!');
          return;
        }
        
        console.log('✅ Module system ready');
        
        // Initialize XAI Module System
        try {
          console.log('🔬 Initializing XAI Module System...');
          
          // Import XAI modules using dynamic import
          const { XAIManager } = await import('./modules/XAI/XAIManager.js');
          
          // Create global XAI manager instance
          window.xaiManager = new XAIManager();
          
          // Initialize XAI system
          await window.xaiManager.init();
          
          console.log('✅ XAI Module System initialized successfully');
          
          // Override dashboard-extended.js XAI methods if available
          if (window.dashboardExtended) {
            // Replace XAI methods with new module calls
            window.dashboardExtended.updateAllXAICharts = () => {
              console.log('[OVERRIDE] Using new XAI module system');
              window.xaiManager.updateAllXAICharts();
            };
            
            window.dashboardExtended.loadXAIData = async () => {
              console.log('[OVERRIDE] Using new XAI module loadXAIData');
              await window.xaiManager.loadXAIData();
            };
          }
          
        } catch (error) {
          console.error('❌ Failed to initialize XAI Module System:', error);
        }
      });
      
      // Global chart recovery function
      function recoverAllCharts() {
        console.log('🔧 Attempting to recover all charts...');
        
        // Recover dashboard charts
        if (window.dashboard && typeof window.dashboard.refreshAllCharts === 'function') {
          console.log('✅ Recovering dashboard charts...');
          window.dashboard.refreshAllCharts();
        }
        
        // Recover router charts
        if (window.router && window.router.currentPage) {
          console.log(`✅ Re-initializing ${window.router.currentPage} page charts...`);
          setTimeout(() => {
            switch (window.router.currentPage) {
              case 'predictions':
                if (typeof window.router.retryPredictionCharts === 'function') {
                  window.router.retryPredictionCharts();
                }
                break;
              case 'news':
                if (typeof window.router.retryNewsCharts === 'function') {
                  window.router.retryNewsCharts();
                }
                break;
              case 'feature-importance':
              case 'shap-analysis':
                if (window.xaiManager && window.xaiManager.isInitialized) {
                  window.xaiManager.updateAllXAICharts();
                }
                break;
              case 'model-explainability':
                if (typeof window.router.retryModelExplainabilityCharts === 'function') {
                  window.router.retryModelExplainabilityCharts();
                }
                break;
              case 'prediction-explanation':
                console.log('🔧 Recovering Prediction Explanation charts...');
                if (typeof window.router.initializePredictionExplanationPage === 'function') {
                  window.router.initializePredictionExplanationPage();
                }
                break;
            }
          }, 500);
        }
      }
      
      // Make recovery function globally available
      window.recoverAllCharts = recoverAllCharts;
      
      // Auto-recover charts after full page load
      setTimeout(() => {
        recoverAllCharts();
      }, 3000);

      // Test function for debugging selectors
      function testSelectors() {
        console.log('🔧 Testing selectors after syntax fix...');
        console.log('dashboardExtended available:', !!window.dashboardExtended);
        
        if (window.dashboardExtended) {
          console.log('✅ dashboardExtended is available!');
          console.log('Calling setupRealtimePredictionsControls...');
          window.dashboardExtended.setupRealtimePredictionsControls();
          
          // Test if event listeners are working
          const stockSelector = document.getElementById('stock-selector');
          const timeframeSelector = document.getElementById('timeframe-selector');
          
          if (stockSelector && timeframeSelector) {
            console.log('🎯 Testing event triggers...');
            stockSelector.dispatchEvent(new Event('change'));
            timeframeSelector.dispatchEvent(new Event('change'));
          }
        } else {
          console.error('❌ dashboardExtended still not available!');
        }
        
        // Test direct DOM access
        const stockSelector = document.getElementById('stock-selector');
        const timeframeSelector = document.getElementById('timeframe-selector');
        
        console.log('Direct DOM access:');
        console.log('- stock-selector found:', !!stockSelector);
        console.log('- timeframe-selector found:', !!timeframeSelector);
        
        if (stockSelector) {
          console.log('- stock-selector options:', stockSelector.options.length);
          console.log('- stock-selector value:', stockSelector.value);
        }
        
        if (timeframeSelector) {
          console.log('- timeframe-selector options:', timeframeSelector.options.length);
          console.log('- timeframe-selector value:', timeframeSelector.value);
        }
      }
    </script>
</body>
</html>